\chapter{Opis implementacji}
\label{implementacja}
\section{Podzia³ aplikacji na modu³y}
Projekt zosta³ podzielony na modu³y, których klasy mia³y podobne przeznaczenie. Modu³y, które wyodrêbniono, to:
\begin{itemize}
	\item [--] \texttt{pl.wroc.pwr.student.lawcreator} -- g³ówny pakiet, który zawiera klasê \texttt{Application}, odpowiedzialn¹ za rozruch aplikacji,
	\item [--] \texttt{pl.wroc.pwr.student.lawcreator.registry} -- zawiera rejestr elementów struktury dokumentu,
	\item [--] \texttt{pl.wroc.pwr.student.lawcreator.utils} -- zawiera klasê \texttt{Mapper}, odpowiedzialn¹ za mapowanie znaczników,
	\item [--] \texttt{pl.wroc.pwr.student.lawcreator.view} -- odpowiedzialny za wyœwietlanie makiet interfejsu u¿ytkownika,
	\item [--] \texttt{pl.wroc.pwr.student.lawcreator.xml} -- posiada klasê \texttt{Parser}, która zajmuje siê przetwarzaniem elementów XML; pakiet zawiera te¿ interfejsy i implementacjê interfejsów skojarzonych z wêz³ami dokumentu XML.
\end{itemize}

\section{Przetwarzanie danych}
W odró¿nieniu od sposobu implementacji w iteracji drugiej (rozdzial~\ref{druga}), dostêpne elementy dokumentu XML nie zosta³y wczytane ze schematu, a wprowadzone za pomoc¹ metody \texttt{createElements()} w klasie \texttt{Parser}. Do uzupe³nienia informacji o elementach struktury s³u¿¹ natomiast metody \texttt{createAttribute()} oraz \texttt{createType()}. Dziêki temu uzyskano pe³ny zestaw informacji o danym wêŸle, na który sk³ada³y siê informacje o elemencie, jego atrybutach i typach tych atrybutów.

Zmianê podejœcia do uzupe³nienia danych wymusi³o to, ¿e schemat XML zawiera³ komentarze, które te¿ nios³y ze sob¹ informacje o zasadach tworzenia dokumentu. Mówi³y np. o tym, czy dany element mo¿e posiadaæ cia³o (innymi s³owy -- mo¿e nieœæ pewn¹ treœæ miêdzy znacznikami), czy te¿ nie. Nowe podejœcie pozwoli³o na rozwi¹zanie tego problemu.

Podobnie jednak do poprzedniej iteracji, istnieje rejestr w postaci klasy \texttt{Registry}. U³atwia to rozwi¹zanie problemu referencji do elementów. W trakcie tworzenia elementów w metodzie \texttt{createElements()} ka¿da definicja elementu jest zapisywana w rejestrze, st¹d jeœli któryœ element posiada referencjê do któregoœ z nich, mo¿e go pobraæ z rejestru. Dziêki zastosowaniu rejestru mo¿emy te¿ ³atwo odbudowaæ strukturê drzewa dokumentu.

Zarówno element, atrybut, jak i typ dokumentu XML posiadaj¹ swoje interfejsy, którymi s¹ odpowiednio \texttt{Element, Attribute} oraz \texttt{Type}, a ich implementacje zawieraj¹ dodatkowo s³owo \texttt{Impl} (czyli implementacj¹ interfejsu \texttt{Type} jest \texttt{TypeImpl}).

Istnieje istotne rozró¿nienie na obiekty pochodz¹ce ze schematu XML i te, które maj¹ znaleŸæ siê w wygenerowanym dokumencie XML. Obiekty, reprezentuj¹ce zawartoœæ schematu XML, s¹ wczeœniej wymienionymi implementacjami interfejsów i nios¹ ze sob¹ informacje jedynie o strukturze, nie zaœ o tym, co ma byæ umieszczone jako wartoœæ znacznika czy atrybutu. Pozwalaj¹ na poprawne wyœwietlenie formularzy, które nastêpnie wype³nia u¿ytkownik. Natomiast obiekty, które maj¹ nieœæ informacje, które bêd¹ zawarte w wygenerowanym przez program dokumencie XML, reprezentuj¹ klasy \texttt{Node} i \texttt{Attribute} z pakietu \texttt{pl.wroc.pwr.student.lawcreator.xml.nodes}. Posiadaj¹ one informacje o nazwie znacznika lub atrybutu oraz jego wartoœci. Co wa¿ne, posiadaj¹ metodê \texttt{toXML()}, która pozwala na ³atwe generowanie pliku XML -- wystarczy wywo³aæ tê metodê na elemencie, bêd¹cym korzeniem drzewiastej struktury XML.

\section{Implementacja interfejsu graficznego}
Interfejs graficzny u¿ytkownika aplikacji zosta³ zbudowany w nastêpuj¹cy sposób. Po lewej stronie u¿ytkownik ma do dyspozycji drzewo elementów, ktore mog¹ znaleŸæ siê w dokumencie. Niektóre z nich posiadaj¹ elementy zagnie¿d¿one i aby do nich dotrzeæ nale¿y rozwin¹æ dany element w drzewie. Po naciœniêciu na dan¹ pozycjê istniej¹ dwie mo¿liwoœci -- albo u¿ytkownik zostaje poinformowany, ¿e element nie posiada atrybutów do wype³nienia (formularz jest pusty), albo pojawia siê formularz z dostêpnymi polami do wype³nienia. Niektóre z nich (np. atrybut Data), s¹ ograniczone pod wzglêdem zawartoœci, tzn. musz¹ spe³niaæ warunki umieszczone w schemacie XML. Atrybut Data mmusi byæ poprawnie sformatowany do postaci: RRRR-MM-DD. Jeœli u¿ytkownik wype³ni takie pole w z³y sposób, zostanie o tym poinformowany w wyœwietlonym oknie dialogowym. 

Jeœli formularz zosta³ wype³niony, mo¿na go zapisaæ - wtedy zostanie on dodany do drzewa, które jest po prawej stronie. Drzewo to reprezentuje elementy, które zosta³y wype³nione i zapisane przez u¿ytkownika. Elementy ostan¹ umieszczone w wygenerowanej postaci XML. Jeœli u¿ytkownik zdecyduje, ¿e dany element zosta³ niepoprawnie wype³niony, mo¿e powróciæ do jego edycji poprzez naciœniêcie na odpowiedni¹ pozycjê w drzewie po prawej stronie. Ostatnim wa¿nym elementem interfejsu jest przycisk "`Generuj XML"', po którego naciœniêciu pojawia siê okno z uzupe³nion¹ uchwa³¹ w postaci XML. Tê zawartoœæ mo¿na skopiowaæ i wkleiæ do nowego dokumentu XML.

Za wyœwietlanie informacji na ekranie i obs³ugê zdarzeñ wywo³anych przez u¿ytkownika, takich jak wybór pozycji w drzewie, czy naciœniêcie przycisku, odpowiada obiekt \texttt{MainWindow}, tworzony przy starcie aplikacji w metodzie \texttt{main()}. Utworzenie tego obiektu powoduje wyœwietlenie g³ównego widoku aplikacji. Aby sta³o siê to mo¿liwe, najpierw inicjalizowane s¹ komponenty, które maj¹ zostaæ wyœwietlone, a nastêpnie wywo³ywana jest metoda \texttt{open()} obiektu klasy \texttt{Shell}. Po otwarciu okna wywo³ywana zostaje metoda \texttt{dispose()} na obiekcie \texttt{MainWindow}. Poniewa¿ biblioteka SWT nie u¿ywa odœmiecacza, to programista musi panowaæ nad zwalnianiem i czyszczeniem obiektów z pamiêci. St¹d te¿ metoda \texttt{dispose()}, która posiada w swoim ciele pêtlê sprawdzaj¹c¹, czy obiekt powinien zostaæ odœmiecony, czy te¿ nie.

